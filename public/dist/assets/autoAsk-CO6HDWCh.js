import{_ as e,m as t,u as a,r as s,a as o,b as n,c as r,d as l,e as i,f as u,t as c,h as m,g as d,o as f,l as g}from"./index-DgD--6rY.js";import{H as p,t as v,E as y,a as b,y as h,s as w,j as x,T as k,e as I,l as $,f as N,g as T,p as S}from"./index-CaXDcX1N.js";const _={style:{display:"flex","flex-direction":"column"}},A={style:{display:"flex","align-items":"center"}},M={class:"text-info"},H={class:"text-info"},L={style:{"margin-left":"20px"}},z={class:"text-info"},D={class:"text-info"},j={style:{display:"flex","flex-direction":"row",height:"calc(100vh - 40px)"}},E={style:{width:"50%",height:"100%",overflow:"auto"}},U=["innerHTML"],V=["disabled"],q=e({__name:"autoAsk",setup(e){const q=t(),C=a(),W=()=>{C.push({name:"Home"})},Y=s(q.query.mobile),J=s(q.query.password),O=p.define([{tag:v.propertyName,color:"#000"},{tag:v.string,color:"#cb8748"},{tag:v.comment,color:"#aaa"},{tag:v.number,color:"#0185ca"},{tag:v.bool,color:"#d7cd61"}]),P=[y.lineWrapping,b(),h(),w(O)],R=s(""),B=s(!1);var F='# ------注意缩进格式-------\n# 是否为测试 true:测试 false:正式\nsubmitTest: true\n\n# 处理回复内容随机取一个\nanswer: \n  - "收到"\n  - "好的，收到"\n\n# 自己发的清单已回复的进行评分\n# 是否进行评分：true:评分(满意) false:不评分\n# 评分为满意，不评分则不处理\nscore: true\n\n# 处理条数：0:全部处理 其他数值:处理指定条数\ndealNum: 0\n\n# 处理时间间隔(分钟)\nrefTime: 0.3\n\n',G=o(x.load(F));G.mobile=Y.value,G.password=J.value;const K=s(F),Q=async()=>{try{const e=K.value;if(!e)return console.error("YAML text is empty."),void Z("YAML text is empty.","error");const t=x.load(e);if(G={...G,...t},!X(G))return void(B.value=!1);le(G)}catch(e){console.error(e),Z("报错了：\n"+e.message,"error"),B.value=!1}},X=e=>{if(!e.answer||e.answer.length<1)return Z("没有回复内容","error"),!1;const t=Number(e.dealNum);return!(isNaN(t)||!Number.isInteger(t)||t<0)||(Z("处理条数配置不正确","error"),!1)},Z=(e,t="info",a=!0)=>{const s=`<span style="color: ${{error:"red",success:"green",warning:"orange",info:"#333"}[t]}">${e} ${a?ee():""}</span>`;R.value=R.value?`${R.value}<br>${s}`:s},ee=()=>(new Date).toLocaleString();var te=o([]),ae=o([]),se=o([]),oe=s(0),ne=s(0);const re=async()=>{try{te=o([]),ae=o([]),se=o([]),oe=s(0),ne=s(0);const e=localStorage.getItem("usertoken")||"";if(!e)return;const t=await I(e);if(600==t.code||"登录过期,请重新登录"==t.msg){const e=await $({mobile:G.mobile,password:G.password});console.log("登录信息:",e),localStorage.setItem("usertoken",e),re()}t.list.forEach((async t=>{"任务待解决-五项清单"==t.type?(t.logInfo="回复",t.isAsk=!0,te.push(t),await N(t.iveId,e)):"任务待评分"==t.type&&(t.logInfo="评分",t.isAsk=!1,ae.push(t)),2==t.readStatus?oe.value++:1==t.readStatus&&ne.value++,se.push(t)}))}catch(e){console.error("获取数量信息失败:",e)}};re();const le=async e=>{try{const a=localStorage.getItem("usertoken")||"";if(!a)return Z("没有token","error"),void(B.value=!1);R.value="";const s=6e4*e.refTime;Z(`定时器间隔：${e.refTime}分钟`);for(const[o,n]of se.entries()){if(e.dealNum>0&&o>=e.dealNum){Z("到达指定数量，停止执行"),B.value=!1;break}{B.value=!0;const r=n.iveId;Z(`${n.logInfo}-第${o+1}个:${r}\n${n.body.trim().slice(0,20)}...`,"info",!1);try{if(n.isAsk){const t=Math.floor(Math.random()*e.answer.length),s=e.answer[t];if(Z("随机回复内容:"+s),!e.submitTest){const e=await T(n,s,a);Z("处理结果:"+JSON.stringify(e))}}else if(!e.submitTest){const e=await S(n,a);console.log("评分结果:",e)}}catch(t){Z(`处理失败: ${t.message}`,"error")}await new Promise((e=>setTimeout(e,s)))}}}catch(t){Z(`操作失败: ${t.message}`,"error")}finally{B.value=!1,re()}};return(e,t)=>{const a=n("a-button");return f(),r("div",_,[l("div",A,[l("div",null,[l("div",M,"需要回复处理："+c(m(te).length),1),l("div",H,"需要评分："+c(m(ae).length),1)]),l("div",L,[l("div",z,"已读："+c(m(oe)),1),l("div",D,"未读："+c(m(ne)),1)]),i(' <button @click="gotoHome" style="margin-left: 20px;">回首页</button> '),u(a,{type:"primary",size:"small",onClick:W,style:{"margin-left":"20px"}},{default:d((()=>t[1]||(t[1]=[g("回首页")]))),_:1}),i(' <a-button type="primary" size="small" @click="gotoDownload" style="margin-left: 20px;">跳转更新(暂不可用)</a-button> '),i(' <router-link :to="{ name: menuInfo.pageName, params: menuInfo.params }" style="margin-left: 20px;">\n                <span>跳转更新</span>\n            </router-link> ')]),l("div",j,[u(m(k),{ref:"mycodemirror",modelValue:K.value,"onUpdate:modelValue":t[0]||(t[0]=e=>K.value=e),disabled:!1,indentWithTab:!0,extensions:P,placeholder:"请输入yaml配置",tabSize:2,style:{height:"100%",width:"50%",resize:"none","text-align":"left"}},null,8,["modelValue"]),l("div",E,[t[2]||(t[2]=l("div",{class:"text-info",style:{"text-align":"left"}},"批量处理打印信息",-1)),l("div",{class:"log-area",innerHTML:R.value,disabled:"true"},null,8,U),l("button",{onClick:Q,disabled:B.value},"开始执行",8,V),i(' <button v-show="isRuning" @click="submitTimer(result, true)">停止执行</button> ')])])])}}},[["__scopeId","data-v-8e73c962"],["__file","/Users/UED/Desktop/test/electron-egg/frontend/src/views/home/autoAsk.vue"]]);export{q as default};

import{_ as e,u as t,r as a,a as l,w as s,b as r,c as n,d as o,e as i,f as u,g as c,t as m,h as d,F as p,i as y,j as v,k as f,v as g,M as h,o as b,l as w,U as x}from"./index-DgD--6rY.js";import{H as _,t as k,E as T,a as S,y as C,s as B,j as U,T as A,n as M,b as I,v as N,l as j,c as $,u as O,d as z}from"./index-CaXDcX1N.js";const q={style:{display:"flex","flex-direction":"column"}},E={style:{display:"flex","align-items":"center","justify-content":"space-between","padding-bottom":"8px"}},L={style:{display:"flex","flex-direction":"column","align-items":"flex-start","min-width":"100px"}},Y={style:{display:"flex","align-items":"center"}},J={style:{"font-size":"15px"}},R={style:{display:"flex","align-items":"center",width:"80%","text-align":"left"}},D={style:{display:"flex","flex-direction":"row","justify-content":"space-between","margin-top":"5px"}},F={style:{display:"flex","flex-direction":"column"}},H={style:{display:"flex","flex-direction":"row",height:"calc(100vh - 40px)"}},P={style:{width:"50%",height:"100%",overflow:"auto"}},K={class:"top"},V={style:{display:"flex","flex-direction":"row","justify-content":"space-around"}},W=["innerHTML"],Q=e({__name:"home",setup(e){const Q=t(),Z=()=>{if(!ve.mobile||ve.mobile.length<1)return alert("没有手机号"),!1;if(!ve.password||ve.password.length<1)return alert("没有密码"),!1;const e={name:"HomeAutoAsk",query:{mobile:ve.mobile,password:ve.password}};Q.push(e)},G=_.define([{tag:k.propertyName,color:"#000"},{tag:k.string,color:"#cb8748"},{tag:k.comment,color:"#aaa"},{tag:k.number,color:"#0185ca"},{tag:k.bool,color:"#d7cd61"}]),X=[T.lineWrapping,S(),C(),B(G)],ee=a(!1),te=a(localStorage.getItem("allTempleStr")||"[]"),ae=l([]);try{const e=JSON.parse(te.value);ae.splice(0,ae.length,...e)}catch(Oe){ae.splice(0,ae.length)}const le=a(localStorage.getItem("allResult")||"{}"),se=JSON.parse(le.value),re=a(se.aiKey||""),ne=a(se.aiModel||""),oe=a(se.apiUrl||""),ie=a(se.mobile||""),ue=a(se.password||""),ce=a(""),me=a(""),de=a(!1);let pe=a(!1);l({});var ye='# ------注意缩进格式-------\n\n# 是否为测试 true:测试 false:正式\nsubmitTest: true\n\n# 可选值：userSequence(顺序执行)/itemCross(交叉执行)\nexecuteMode: "userSequence" \n\n# 责任人和执行人(名字不能输错)\n# 如果人名重复推荐使用【手机号】\n# 使用多级数组当前示例是给一个人提交的示例\n# 注意格式要对齐\nsubmitBodyInfo:\n  - "xxx": \n    - "示例：要改掉"\n\n# 0:会自动填写1或5 1:中心 2:自己 3:对领导 4:对下属 5:对内部\ntype: "0"\n\n# 发送间隔时间分钟\nrefTime: \n\n# 需要提报的数量(自己定义)\nsubmitNumber: \n\n# 提出人区域：NC:南昌分公司,CQ:忠县分公司,FY:阜阳分公司,HF:合肥分公司,ZB:上海总部/含集团河姆渡集光,各战区/各分支\narea: ""\n\n# 紧急程度 A:重要且紧急 B:重要不紧急 C:不重要紧急\nlevel: ""\n\n# 结束时间 0:当月最后一天 1:当前时间+1天 2:当前时间+2天 以此类推\nfinishTimeType: 0\n# 提交时间随机增加分钟范围\nfinishTimeAutom: 1\n\n# 提交数据\nsubmitData:\n  id: ""\n  flowId: ""\n  readStatus: "1"\n  isxs: "1"\n  nos: ""\n  task_from: "0"\n  raise_user_id: ""\n  raise_user_name: ""\n  # 提出人所在中心(会被上面的覆盖掉)\n  raise_user_centre: ""\n  # 1:中心 2:自己 3:对领导 4:对下属 5:对内部(会被上面的覆盖掉)\n  type: "0"\n  # 提出人区域(会被上面的覆盖掉)\n  area: "FY"\n  crmArea: ""\n  # 紧急程度 A:重要且紧急 B:重要不紧急 C:不重要紧急(会被上面的覆盖掉)\n  level: "C"\n  # 使用上面的submitBody\n  body: ""\n  attach_url: []\n  owner_user_id: ""\n  owner_user_name: ""\n  owner_user_centre: ""\n  execute_user_id: []\n  execute_user_name: ""\n  # 完成时间(毫秒时间戳13位，https://www.jyshare.com/front-end/852/?utm_source=heifan)\n  # 如果时间戳为0则自动获取当前月份的最后一天时间23:00:00.000的时间戳\n  finish_time: 0\n  beforeJudge: 2\n  create_time: ""\n  meeting_resolution_time: null\n  status: 3\n  jnpf_meeting_task_jnpf_is_satisfaction: "-1"\n',ve=l(U.load(ye));ve.aiKey=re.value,ve.aiModel=ne.value,ve.apiUrl=oe.value,ve.mobile=ie.value,ve.password=ue.value;const fe=a(se.refTime||1),ge=a(se.area||"FY"),he=a(se.level||"C"),be=a(se.executeMode||""),we=a(se.submitNumber||1),xe=a(0);ve.refTime=fe.value,ve.area=ge.value,ve.level=he.value,ve.executeMode=be.value,ve.submitNumber=we.value,ye=(ye=(ye=(ye=(ye=ye.replace("refTime: ",`refTime: ${ve.refTime}`)).replace('area: ""',`area: "${ve.area}"`)).replace('level: ""',`level: "${ve.level}"`)).replace('executeMode: ""',`executeMode: "${ve.executeMode}"`)).replace("submitNumber: ",`submitNumber: ${ve.submitNumber}`);const _e=a(ye),ke=async()=>{try{const e=_e.value;if(ce.value="",me.value="",de.value=!0,!e)return console.error("YAML text is empty."),Ce("YAML text is empty.","error"),void(de.value=!1);const t=U.load(e);if((ve={...ve,...t}).toUser=ve.submitBodyInfo.map((e=>Object.keys(e)[0])),ve.submitBody=ve.submitBodyInfo.map((e=>Object.values(e)[0])),!Te(ve))return void(de.value=!1);localStorage.setItem("allResult",JSON.stringify(ve)),Ce("开始登录");const a=await j({mobile:ve.mobile,password:ve.password});if(localStorage.setItem("usertoken",a),a){Ce("登录成功","success"),Ce("开始获取登录信息"),Ne();await $()?(Ce("获取登录信息成功","success"),Se(ve)):(Ce("获取登录信息失败","error"),de.value=!1)}else Ce("登录失败","error"),de.value=!1}catch(Oe){console.error(Oe),Ce("报错了：\n"+Oe.message,"error"),de.value=!1}},Te=e=>!e.mobile||e.mobile.length<1?(Ce("没有手机号","error"),!1):!e.password||e.password.length<1?(Ce("没有密码","error"),!1):["userSequence","itemCross"].includes(e.executeMode)?e.toUser.length<1||e.toUser[0].length<1?(Ce("没有接收人","error"),!1):e.area.length<1?(Ce("没有提出人区域","error"),!1):e.submitBody.length<1||e.submitBody[0].length<1?(Ce("没有提交内容","error"),!1):!(e.toUser.length!==e.submitBody.length||!e.submitBody.every((e=>e.length>0)))||(Ce("接收人和提交内容维度不匹配","error"),!1):(Ce("无效的执行模式","error"),!1),Se=async(e,t=!1)=>{try{if(t)throw Ce("已请求停止执行","warning"),new Error("用户主动中止循环");{const t=6e4*e.refTime;Ce(`定时器间隔：${e.refTime}分钟`);const a=async(t,a)=>{const l=e.submitBody[t][a],s=e.toUser[t];Ce(`提交给【${s}】的第 ${a+1} 项任务`);var r=l;if(e.aiKey.length){Ce("使用AI进行处理");var n=await O(l,e);n&&n.choices&&n.choices.length>0?(r=n.choices[0].message.content,Ce("AI返回信息："+r)):Ce("AI返回数据异常，使用默认值")}var o=await z(s,r,e);if(-1!=o.indexOf("没有找到touser用户信息"))throw Ce(o,"error"),new Error("找不到接收人");if(-1!=o.indexOf("没有找到用户信息"))throw Ce(o,"error"),new Error("没有找到用户信息");if(-1!=o.indexOf("提交失败"))throw Ce(o,"error"),new Error("提交失败了，稍后尝试");Ce(o,"success")},l={userSequence:async()=>{for(let l=0;l<e.toUser.length;l++){const s=e.submitBody[l];for(let e=0;e<s.length;e++){if(!de.value)return;await a(l,e),await new Promise((e=>setTimeout(e,t)))}}},itemCross:async()=>{const l=Math.max(...e.submitBody.map((e=>e.length)));for(let s=0;s<l;s++)for(let l=0;l<e.toUser.length;l++)if(s<e.submitBody[l].length){if(!de.value)return;await a(l,s),await new Promise((e=>setTimeout(e,t)))}}};"userSequence"===e.executeMode?await l.userSequence():await l.itemCross(),Ce("所有提交已结束，请重新配置")}}catch(Oe){if(!Oe.message.includes("中止循环"))throw Ce(""+Oe.message,"error"),Oe;Ce(Oe.message,"error")}finally{de.value=!1,ee.value=!1,Ie()}},Ce=(e,t="info")=>{const a=`<span style="color: ${{error:"red",success:"green",warning:"orange",info:"#333"}[t]}">${e} ${Be()}</span>`;me.value=me.value?`${me.value}<br>${a}`:a},Be=()=>(new Date).toLocaleString(),Ue=()=>{ae.push({name:`模版${ae.length+1}`,content:_e.value}),Ae()},Ae=()=>{const e=JSON.stringify(ae);localStorage.setItem("allTempleStr",e)};var Me=l({t1:0,t2:0,t3:0,t4:0,t5:0,t6:0,t7:0});const Ie=async()=>{try{const e=localStorage.getItem("usertoken")||"";if(!e)return void Object.assign(Me,{t2:"未登录",t4:"未登录"});const t=await M(e);Object.assign(Me,t),xe.value=Me.t2/ve.submitNumber*100}catch(Oe){console.error("获取数量信息失败:",Oe)}};s((()=>_e.value),(e=>{try{const t=U.load(e),a=Number(null==t?void 0:t.submitNumber)||0;ve.submitNumber=a,localStorage.setItem("allResult",JSON.stringify(ve)),xe.value=Me.t2/a*100}catch(Oe){console.error("YAML解析失败",Oe)}}),{immediate:!0});const Ne=async()=>{try{var e=await I();e.showAll?pe.value=!0:pe=e.userList.some((e=>e.mobile===ve.mobile))}catch(Oe){console.error("获取用户列表失败:",Oe)}},je=async()=>{try{var e=await N();e.showPop&&h.success({title:e.title,content:e.newInfo,okText:e.okText,okType:e.okType,okButtonProps:e.okButtonProps,closable:!e.mustDown,keyboard:!1,maskClosable:!1,onOk(){var t;e.downloadUrl&&(t=e.downloadUrl,$e.openExternal(t)),je()}})}catch(Oe){console.error("获取用跟新失败:",Oe)}},{shell:$e}=require("electron");return Ie(),Ne(),je(),(e,t)=>{const a=r("a-progress"),l=r("a-input"),s=r("a-button"),h=r("a-input-password");return b(),n("div",q,[o("div",E,[o("div",L,[o("div",Y,[t[4]||(t[4]=o("div",null,"总提报：",-1)),u(a,{type:"dashboard",percent:xe.value,size:30},{format:c((e=>[o("span",J,m(d(Me).t2),1)])),_:1},8,["percent"])]),i(" <div>总提报：{{ numberResult.t2 }}</div> "),o("div",null,"未处理："+m(d(Me).t4),1)]),o("div",R,[(b(!0),n(p,null,y(ae,((e,a)=>(b(),n("div",{key:e,style:{display:"flex","flex-direction":"column","margin-left":"8px",width:"100px"}},[u(l,{type:"text",value:e.name,"onUpdate:value":t=>e.name=t,style:{width:"100%","margin-right":"5px"},onBlur:Ae},null,8,["value","onUpdate:value"]),o("div",D,[u(s,{type:"primary",size:"small",onClick:e=>(e=>{_e.value=ae[e].content})(a)},{default:c((()=>[...t[5]||(t[5]=[w("使用")])])),_:2},1032,["onClick"]),u(s,{type:"primary",size:"small",danger:"",onClick:e=>(e=>{ae.splice(e,1),Ae()})(a)},{default:c((()=>[...t[6]||(t[6]=[w("删除")])])),_:2},1032,["onClick"])])])))),128)),u(s,{type:"primary",size:"small",onClick:Ue,style:{"margin-left":"20px"}},{default:c((()=>t[7]||(t[7]=[w("保存当前配置为模版")]))),_:1}),i(' <button style="margin-left: 18px;max-height: 50px;" @click="saveCurrentTemple">保存当前配置为模版</button> ')]),o("div",F,[d(pe)?(b(),v(s,{key:0,type:"primary",size:"small",onClick:Z},{default:c((()=>t[8]||(t[8]=[w("跳转回复")]))),_:1})):i("v-if",!0),i(' <a-button type="primary" size="small" danger @click="closeApp">退出程序</a-button> '),i(' <button v-if="showAsk" style="margin-left: 8px;max-height: 50px;" @click="gotoAsk">跳转回复</button> '),i(' <button style="margin-left: 8px;max-height: 50px;" @click="closeApp">退出程序</button> ')])]),o("div",H,[i(' <textarea name="yaml" id="" v-model="yamlContent" style="height: 100%;width: 30%;resize: none;"\n                spellcheck="false"></textarea> '),u(d(A),{ref:"mycodemirror",modelValue:_e.value,"onUpdate:modelValue":t[0]||(t[0]=e=>_e.value=e),disabled:!1,indentWithTab:!0,extensions:X,placeholder:"请输入yaml配置",tabSize:2,style:{height:"100%",width:"50%",resize:"none","text-align":"left"}},null,8,["modelValue"]),o("div",P,[o("div",K,[o("div",V,[i(' <input type="text" placeholder="请输入手机号" v-model="result.mobile" /> '),i(' <input type="password" placeholder="请输入密码" v-model="result.password" /> '),u(l,{value:d(ve).mobile,"onUpdate:value":t[1]||(t[1]=e=>d(ve).mobile=e),placeholder:"Basic usage"},{prefix:c((()=>[u(d(x))])),_:1},8,["value"]),u(h,{value:d(ve).password,"onUpdate:value":t[2]||(t[2]=e=>d(ve).password=e),placeholder:"input password"},null,8,["value"])]),i(' <div>\n                        <input type="password" placeholder="ai的key，为空不使用AI" v-model="result.aiKey" />\n                        <input type="text" placeholder="ai的模型" v-model="result.aiModel" />\n                        <input type="text" placeholder="为空则使用https://api.openai.com" v-model="result.apiUrl" />\n                    </div> ')]),t[11]||(t[11]=o("div",{class:"text-info",style:{"text-align":"left"}},"清单打印信息",-1)),o("div",{class:"log-area",innerHTML:me.value,disabled:"true"},null,8,W),i(' <button @click="parseYaml" :disabled="isRuning">开始执行</button> '),i(' <button v-show="isRuning" @click="submitTimer(result, true)">停止执行</button> '),u(s,{type:"primary",onClick:ke,disabled:de.value},{default:c((()=>t[9]||(t[9]=[w("开始执行")]))),_:1},8,["disabled"]),f(u(s,{type:"primary",onClick:t[3]||(t[3]=e=>Se(d(ve),!0))},{default:c((()=>t[10]||(t[10]=[w("停止执行")]))),_:1},512),[[g,de.value]])])])])}}},[["__scopeId","data-v-edfe046f"],["__file","/Users/UED/Desktop/test/electron-egg/frontend/src/views/home/home.vue"]]);export{Q as default};

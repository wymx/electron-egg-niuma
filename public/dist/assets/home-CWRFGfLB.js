import{_ as e,u as t,r as n,a,c as r,b as l,d as s,t as o,e as i,F as u,f as c,g as d,w as m,v as p,h as f,o as h}from"./index-DSfCEzuv.js";import{H as v,t as y,E as g,a as x,y as w,s as b,j as _,T as S,n as C,b as k,l as T,c as U,u as M,d as B}from"./index-BHBia7TR.js";const $={style:{display:"flex","flex-direction":"column"}},A={style:{display:"flex","align-items":"center"}},I={style:{display:"flex","flex-direction":"column"}},j=["onUpdate:modelValue"],q={style:{display:"flex","flex-direction":"row","justify-content":"space-around"}},O=["onClick"],V=["onClick"],E={style:{display:"flex","flex-direction":"row",height:"calc(100vh - 40px)"}},N={style:{width:"50%",height:"100%",overflow:"auto"}},F={class:"top"},H={style:{display:"flex","flex-direction":"row","justify-content":"space-around"}},J=["innerHTML"],L=["disabled"],Y=e({__name:"home",setup(e){const Y=t(),D=()=>{if(!ue.mobile||ue.mobile.length<1)return alert("没有手机号"),!1;if(!ue.password||ue.password.length<1)return alert("没有密码"),!1;const e={name:"HomeAutoAsk",query:{mobile:ue.mobile,password:ue.password}};Y.push(e)},K=v.define([{tag:y.propertyName,color:"#000"},{tag:y.string,color:"#cb8748"},{tag:y.comment,color:"#aaa"},{tag:y.number,color:"#0185ca"},{tag:y.bool,color:"#d7cd61"}]),z=[g.lineWrapping,x(),w(),b(K)],R=n(!1),P=n(localStorage.getItem("allTempleStr")||"[]"),W=a([]);try{const e=JSON.parse(P.value);W.splice(0,W.length,...e)}catch(Te){W.splice(0,W.length)}const Q=n(localStorage.getItem("allResult")||"{}"),Z=JSON.parse(Q.value),G=n(Z.aiKey||""),X=n(Z.aiModel||""),ee=n(Z.apiUrl||""),te=n(Z.mobile||""),ne=n(Z.password||""),ae=n(""),re=n(""),le=n(!1);let se=n(!1);var oe=a([]),ie='# ------注意缩进格式-------\n\n# 是否为测试 true:测试 false:正式\nsubmitTest: true\n\n# 可选值：userSequence(顺序执行)/itemCross(交叉执行)\nexecuteMode: "userSequence" \n\n# 责任人和执行人(名字不能输错)\n# 如果人名重复推荐使用【手机号】\n# 使用多级数组当前示例是给一个人提交的示例\ntoUser:\n  - "xxx"\n\n# 清单数组(注意下面的格式，要和示例相同，缩进相同，当前示例为一维数组)\n# - 要对齐，格式，格式，格式\nsubmitBody:\n  - \n    - "示例：要改掉"\n\n# 0:会自动填写1或5 1:中心 2:自己 3:对领导 4:对下属 5:对内部\ntype: "0"\n\n# 发送间隔时间分钟\nrefTime: \n\n# 提出人区域：NC:南昌分公司,CQ:忠县分公司,FY:阜阳分公司,HF:合肥分公司,ZB:上海总部/含集团河姆渡集光,各战区/各分支\narea: ""\n\n# 紧急程度 A:重要且紧急 B:重要不紧急 C:不重要紧急\nlevel: ""\n\n# 结束时间 0:当月最后一天 1:当前时间+1天 2:当前时间+2天 以此类推\nfinishTimeType: 0\n# 提交时间随机增加分钟范围\nfinishTimeAutom: 1\n\n# 提交数据\nsubmitData:\n  id: ""\n  flowId: ""\n  readStatus: "1"\n  isxs: "1"\n  nos: ""\n  task_from: "0"\n  raise_user_id: ""\n  raise_user_name: ""\n  # 提出人所在中心(会被上面的覆盖掉)\n  raise_user_centre: ""\n  # 1:中心 2:自己 3:对领导 4:对下属 5:对内部(会被上面的覆盖掉)\n  type: "0"\n  # 提出人区域(会被上面的覆盖掉)\n  area: "FY"\n  crmArea: ""\n  # 紧急程度 A:重要且紧急 B:重要不紧急 C:不重要紧急(会被上面的覆盖掉)\n  level: "C"\n  # 使用上面的submitBody\n  body: ""\n  attach_url: []\n  owner_user_id: ""\n  owner_user_name: ""\n  owner_user_centre: ""\n  execute_user_id: []\n  execute_user_name: ""\n  # 完成时间(毫秒时间戳13位，https://www.jyshare.com/front-end/852/?utm_source=heifan)\n  # 如果时间戳为0则自动获取当前月份的最后一天时间23:00:00.000的时间戳\n  finish_time: 0\n  beforeJudge: 2\n  create_time: ""\n  meeting_resolution_time: null\n  status: 3\n  jnpf_meeting_task_jnpf_is_satisfaction: "-1"\n',ue=a(_.load(ie));ue.aiKey=G.value,ue.aiModel=X.value,ue.apiUrl=ee.value,ue.mobile=te.value,ue.password=ne.value;const ce=n(Z.refTime||1),de=n(Z.area||"FY"),me=n(Z.level||"C"),pe=n(Z.executeMode||"");ue.refTime=ce.value,ue.area=de.value,ue.level=me.value,ue.executeMode=pe.value,ie=(ie=(ie=(ie=ie.replace("refTime: ",`refTime: ${ue.refTime}`)).replace('area: ""',`area: "${ue.area}"`)).replace('level: ""',`level: "${ue.level}"`)).replace('executeMode: ""',`level: "${ue.executeMode}"`);const fe=n(ie),he=async()=>{try{const e=fe.value;if(ae.value="",re.value="",le.value=!0,!e)return console.error("YAML text is empty."),ge("YAML text is empty.","error"),void(le.value=!1);const t=_.load(e);if(ue={...ue,...t},!ve(ue))return void(le.value=!1);localStorage.setItem("allResult",JSON.stringify(ue)),ge("开始登录");const n=await T({mobile:ue.mobile,password:ue.password});if(localStorage.setItem("usertoken",n),n){ge("登录成功","success"),ge("开始获取登录信息"),ke();await U()?(ge("获取登录信息成功","success"),ye(ue)):(ge("获取登录信息失败","error"),le.value=!1)}else ge("登录失败","error"),le.value=!1}catch(Te){console.error(Te),ge("报错了：\n"+Te.message,"error"),le.value=!1}},ve=e=>!e.mobile||e.mobile.length<1?(ge("没有手机号","error"),!1):!e.password||e.password.length<1?(ge("没有密码","error"),!1):["userSequence","itemCross"].includes(e.executeMode)?e.toUser.length<1||e.toUser[0].length<1?(ge("没有接收人","error"),!1):e.area.length<1?(ge("没有提出人区域","error"),!1):e.submitBody.length<1||e.submitBody[0].length<1?(ge("没有提交内容","error"),!1):!(e.toUser.length!==e.submitBody.length||!e.submitBody.every((e=>e.length>0)))||(ge("接收人和提交内容维度不匹配","error"),!1):(ge("无效的执行模式","error"),!1),ye=async(e,t=!1)=>{try{if(t)throw ge("已请求停止执行","warning"),new Error("用户主动中止循环");const n=6e4*e.refTime;ge(`定时器间隔：${e.refTime}分钟`);const a=async(t,n)=>{const a=e.submitBody[t][n],r=e.toUser[t];ge(`提交给【${r}】的第 ${n+1} 项任务`);var l=a;if(e.aiKey.length){ge("使用AI进行处理");var s=await M(a,e);s&&s.choices&&s.choices.length>0?(l=s.choices[0].message.content,ge("AI返回信息："+l)):ge("AI返回数据异常，使用默认值")}var o=await B(r,l,e);if(-1!=o.indexOf("没有找到touser用户信息"))throw ge(o,"error"),new Error("找不到接收人");if(-1!=o.indexOf("没有找到用户信息"))throw ge(o,"error"),new Error("没有找到用户信息");if(-1!=o.indexOf("提交失败"))throw ge(o,"error"),new Error("提交失败了，稍后尝试");ge(o,"success")},r={userSequence:async()=>{for(let t=0;t<e.toUser.length;t++){const r=e.submitBody[t];for(let e=0;e<r.length;e++){if(!le.value)return;await a(t,e),await new Promise((e=>setTimeout(e,n)))}}},itemCross:async()=>{const t=Math.max(...e.submitBody.map((e=>e.length)));for(let r=0;r<t;r++)for(let t=0;t<e.toUser.length;t++)if(r<e.submitBody[t].length){if(!le.value)return;await a(t,r),await new Promise((e=>setTimeout(e,n)))}}};"userSequence"===e.executeMode?await r.userSequence():await r.itemCross(),ge("所有提交已完成，请重新配置")}catch(Te){if(!Te.message.includes("中止循环"))throw Te;ge(Te.message,"error"),ge(""+Te.message,"error")}finally{le.value=!1,R.value=!1,Ce()}},ge=(e,t="info")=>{const n=`<span style="color: ${{error:"red",success:"green",warning:"orange",info:"#333"}[t]}">${e} ${xe()}</span>`;re.value=re.value?`${re.value}<br>${n}`:n},xe=()=>(new Date).toLocaleString(),we=()=>{W.push({name:`模版${W.length+1}`,content:fe.value}),be()},be=()=>{const e=JSON.stringify(W);localStorage.setItem("allTempleStr",e)},_e=()=>{const{ipcRenderer:e}=require("electron");e.send("app-quit")};var Se=a({t1:0,t2:0,t3:0,t4:0,t5:0,t6:0,t7:0});const Ce=async()=>{try{const e=localStorage.getItem("usertoken")||"";if(!e)return void Object.assign(Se,{t2:"未登录",t4:"未登录"});const t=await C(e);Object.assign(Se,t)}catch(Te){console.error("获取数量信息失败:",Te)}};Ce();const ke=async()=>{try{oe=await k(),se=oe.some((e=>e.mobile===ue.mobile))}catch(Te){console.error("获取用户列表失败:",Te)}};return ke(),(e,t)=>(h(),r("div",$,[l("div",A,[l("div",I,[l("div",null,"总提报："+o(i(Se).t2),1),l("div",null,"未处理："+o(i(Se).t4),1)]),(h(!0),r(u,null,c(W,((e,t)=>(h(),r("div",{key:e,style:{display:"flex","flex-direction":"column","margin-left":"8px"}},[m(l("input",{type:"text","onUpdate:modelValue":t=>e.name=t,style:{width:"80px","margin-right":"5px"},onBlur:be},null,40,j),[[p,e.name]]),l("div",q,[l("button",{onClick:e=>(e=>{fe.value=W[e].content})(t)},"使用",8,O),l("button",{onClick:e=>(e=>{W.splice(e,1),be()})(t)},"删除",8,V)])])))),128)),l("button",{style:{"margin-left":"18px","max-height":"50px"},onClick:we},"保存当前配置为模版"),l("button",{style:{"margin-left":"8px","max-height":"50px"},onClick:_e},"退出"),i(se)?(h(),r("div",{key:0,style:{"margin-left":"8px","max-height":"50px"},onClick:D},"跳转回复")):s("v-if",!0)]),l("div",E,[s(' <textarea name="yaml" id="" v-model="yamlContent" style="height: 100%;width: 30%;resize: none;"\n                spellcheck="false"></textarea> '),d(i(S),{ref:"mycodemirror",modelValue:fe.value,"onUpdate:modelValue":t[0]||(t[0]=e=>fe.value=e),disabled:!1,indentWithTab:!0,extensions:z,placeholder:"请输入yaml配置",tabSize:2,style:{height:"100%",width:"50%",resize:"none","text-align":"left"}},null,8,["modelValue"]),l("div",N,[l("div",F,[l("div",H,[m(l("input",{type:"text",placeholder:"请输入手机号","onUpdate:modelValue":t[1]||(t[1]=e=>i(ue).mobile=e)},null,512),[[p,i(ue).mobile]]),m(l("input",{type:"password",placeholder:"请输入密码","onUpdate:modelValue":t[2]||(t[2]=e=>i(ue).password=e)},null,512),[[p,i(ue).password]])]),s(' <div>\n                        <input type="password" placeholder="ai的key，为空不使用AI" v-model="result.aiKey" />\n                        <input type="text" placeholder="ai的模型" v-model="result.aiModel" />\n                        <input type="text" placeholder="为空则使用https://api.openai.com" v-model="result.apiUrl" />\n                    </div> ')]),t[4]||(t[4]=l("div",{class:"text-info",style:{"text-align":"left"}},"清单打印信息",-1)),l("div",{class:"log-area",innerHTML:re.value,disabled:"true"},null,8,J),l("button",{onClick:he,disabled:le.value},"开始执行",8,L),m(l("button",{onClick:t[3]||(t[3]=e=>ye(i(ue),!0))},"停止执行",512),[[f,le.value]])])])]))}},[["__scopeId","data-v-edfe046f"],["__file","/Users/UED/Desktop/test/electron-egg/frontend/src/views/home/home.vue"]]);export{Y as default};

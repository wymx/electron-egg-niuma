import{_ as e,i as s,u as t,r as a,a as o,c as n,b as r,d as l,t as i,e as c,g as u,o as d}from"./index-CMRwiCsZ.js";import{H as m,t as f,E as g,a as v,y as p,s as y,j as h,T as b,e as w,l as x,f as k,p as N}from"./index-BmVm_FQ_.js";const $={style:{display:"flex","flex-direction":"column"}},I={style:{display:"flex","align-items":"center"}},T={class:"text-info"},A={class:"text-info"},_={style:{display:"flex","flex-direction":"row",height:"calc(100vh - 40px)"}},M={style:{width:"50%",height:"100%",overflow:"auto"}},S=["innerHTML"],L=["disabled"],H=e({__name:"autoAsk",setup(e){const H=s(),j=t(),D=()=>{j.push({name:"Home"})},E=a(H.query.mobile),U=a(H.query.password),V=m.define([{tag:f.propertyName,color:"#000"},{tag:f.string,color:"#cb8748"},{tag:f.comment,color:"#aaa"},{tag:f.number,color:"#0185ca"},{tag:f.bool,color:"#d7cd61"}]),q=[g.lineWrapping,v(),p(),y(V)],z=a(""),C=a(!1);var W='# ------注意缩进格式-------\n# 是否为测试 true:测试 false:正式\nsubmitTest: true\n\n# 处理回复内容随机取一个\nanswer: \n  - "收到"\n  - "好的，收到"\n\n# 自己发的清单已回复的进行评分\n# 是否进行评分：true:评分(满意) false:不评分\n# 评分为满意，不评分则不处理\nscore: true\n\n# 处理条数：0:全部处理 其他数值:处理指定条数\ndealNum: 0\n\n# 处理时间间隔(分钟)\nrefTime: 0.3\n\n',Y=o(h.load(W));Y.mobile=E.value,Y.password=U.value;const J=a(W),O=async()=>{try{const e=J.value;if(!e)return console.error("YAML text is empty."),void R("YAML text is empty.","error");const s=h.load(e);if(Y={...Y,...s},!P(Y))return void(C.value=!1);X(Y)}catch(e){console.error(e),R("报错了：\n"+e.message,"error"),C.value=!1}},P=e=>{if(!e.answer||e.answer.length<1)return R("没有回复内容","error"),!1;const s=Number(e.dealNum);return!(isNaN(s)||!Number.isInteger(s)||s<0)||(R("处理条数配置不正确","error"),!1)},R=(e,s="info",t=!0)=>{const a=`<span style="color: ${{error:"red",success:"green",warning:"orange",info:"#333"}[s]}">${e} ${t?B():""}</span>`;z.value=z.value?`${z.value}<br>${a}`:a},B=()=>(new Date).toLocaleString();var F=o([]),G=o([]),K=o([]);const Q=async()=>{try{F=o([]),G=o([]),K=o([]);const e=localStorage.getItem("usertoken")||"";if(!e)return;const s=await w(e);if(600==s.code||"登录过期,请重新登录"==s.msg){const e=await x({mobile:Y.mobile,password:Y.password});console.log("登录信息:",e),localStorage.setItem("usertoken",e),Q()}console.log("获取数量信息333:",s),s.list.forEach((e=>{"任务待解决-五项清单"==e.type?(e.logInfo="回复",e.isAsk=!0,F.push(e)):"任务待评分"==e.type&&(e.logInfo="评分",e.isAsk=!1,G.push(e)),K.push(e)}))}catch(e){console.error("获取数量信息失败:",e)}};Q();const X=async e=>{try{const t=localStorage.getItem("usertoken")||"";if(!t)return R("没有token","error"),void(C.value=!1);z.value="";const a=6e4*e.refTime;R(`定时器间隔：${e.refTime}分钟`);for(const[o,n]of K.entries()){if(e.dealNum>0&&o>=e.dealNum){R("到达指定数量，停止执行"),C.value=!1;break}{C.value=!0;const r=n.iveId;R(`${n.logInfo}-第${o+1}个:${r}\n${n.body.trim().slice(0,20)}...`,"info",!1);try{if(n.isAsk){const s=Math.floor(Math.random()*e.answer.length),a=e.answer[s];if(R("随机回复内容:"+a),!e.submitTest){const e=await k(n,a,t);R("处理结果:"+JSON.stringify(e))}}else if(!e.submitTest){const e=await N(n,t);console.log("评分结果:",e)}}catch(s){R(`处理失败: ${s.message}`,"error")}o!=K.length-1&&o+1<e.dealNum&&await new Promise((e=>setTimeout(e,a)))}}}catch(s){R(`操作失败: ${s.message}`,"error")}finally{C.value=!1,Q()}};return(e,s)=>(d(),n("div",$,[r("div",I,[r("div",null,[r("div",T,"需要回复处理："+i(c(F).length),1),r("div",A,"需要评分："+i(c(G).length),1)]),r("div",{onClick:D,style:{"margin-left":"20px"}},"首页"),l(' <router-link :to="{ name: menuInfo.pageName, params: menuInfo.params }">\n                <span>跳转更新</span>\n            </router-link> ')]),r("div",_,[u(c(b),{ref:"mycodemirror",modelValue:J.value,"onUpdate:modelValue":s[0]||(s[0]=e=>J.value=e),disabled:!1,indentWithTab:!0,extensions:q,placeholder:"请输入yaml配置",tabSize:2,style:{height:"100%",width:"50%",resize:"none","text-align":"left"}},null,8,["modelValue"]),r("div",M,[s[1]||(s[1]=r("div",{class:"text-info",style:{"text-align":"left"}},"批量处理打印信息",-1)),r("div",{class:"log-area",innerHTML:z.value,disabled:"true"},null,8,S),r("button",{onClick:O,disabled:C.value},"开始执行",8,L),l(' <button v-show="isRuning" @click="submitTimer(result, true)">停止执行</button> ')])])]))}},[["__scopeId","data-v-8e73c962"],["__file","/Users/UED/Desktop/test/electron-egg/frontend/src/views/home/autoAsk.vue"]]);export{H as default};

import{_ as e,u as t,r as a,a as n,c as r,b as l,d as o,t as s,e as i,F as u,f as c,g as d,w as m,v as p,h as f,o as y}from"./index-CMRwiCsZ.js";import{H as v,t as h,E as g,a as x,y as w,s as b,j as _,T as S,n as k,b as C,l as T,c as B,u as U,d as I}from"./index-BmVm_FQ_.js";const M={style:{display:"flex","flex-direction":"column"}},$={style:{display:"flex","align-items":"center"}},j={style:{display:"flex","flex-direction":"column"}},A=["onUpdate:modelValue"],O={style:{display:"flex","flex-direction":"row","justify-content":"space-around"}},q=["onClick"],V=["onClick"],E={style:{display:"flex","flex-direction":"row",height:"calc(100vh - 40px)"}},N={style:{width:"50%",height:"100%",overflow:"auto"}},F={class:"top"},H={style:{display:"flex","flex-direction":"row","justify-content":"space-around"}},J=["innerHTML"],L=["disabled"],Y=e({__name:"home",setup(e){const Y=t(),D=()=>{if(!ue.mobile||ue.mobile.length<1)return alert("没有手机号"),!1;if(!ue.password||ue.password.length<1)return alert("没有密码"),!1;const e={name:"HomeAutoAsk",query:{mobile:ue.mobile,password:ue.password}};Y.push(e)},K=v.define([{tag:h.propertyName,color:"#000"},{tag:h.string,color:"#cb8748"},{tag:h.comment,color:"#aaa"},{tag:h.number,color:"#0185ca"},{tag:h.bool,color:"#d7cd61"}]),z=[g.lineWrapping,x(),w(),b(K)],R=a(!1),P=a(localStorage.getItem("allTempleStr")||"[]"),W=n([]);try{const e=JSON.parse(P.value);W.splice(0,W.length,...e)}catch(Te){W.splice(0,W.length)}const Q=a(localStorage.getItem("allResult")||"{}"),Z=JSON.parse(Q.value),G=a(Z.aiKey||""),X=a(Z.aiModel||""),ee=a(Z.apiUrl||""),te=a(Z.mobile||""),ae=a(Z.password||""),ne=a(""),re=a(""),le=a(!1);let oe=a(!1);var se=n([]),ie='# ------注意缩进格式-------\n\n# 是否为测试 true:测试 false:正式\nsubmitTest: true\n\n# 可选值：userSequence(顺序执行)/itemCross(交叉执行)\nexecuteMode: "userSequence" \n\n# 责任人和执行人(名字不能输错)\n# 如果人名重复推荐使用【手机号】\n# 使用多级数组当前示例是给一个人提交的示例\n# 注意格式要对齐\nsubmitBodyInfo:\n  - "xxx": \n    - "示例：要改掉"\n\n# 0:会自动填写1或5 1:中心 2:自己 3:对领导 4:对下属 5:对内部\ntype: "0"\n\n# 发送间隔时间分钟\nrefTime: \n\n# 提出人区域：NC:南昌分公司,CQ:忠县分公司,FY:阜阳分公司,HF:合肥分公司,ZB:上海总部/含集团河姆渡集光,各战区/各分支\narea: ""\n\n# 紧急程度 A:重要且紧急 B:重要不紧急 C:不重要紧急\nlevel: ""\n\n# 结束时间 0:当月最后一天 1:当前时间+1天 2:当前时间+2天 以此类推\nfinishTimeType: 0\n# 提交时间随机增加分钟范围\nfinishTimeAutom: 1\n\n# 提交数据\nsubmitData:\n  id: ""\n  flowId: ""\n  readStatus: "1"\n  isxs: "1"\n  nos: ""\n  task_from: "0"\n  raise_user_id: ""\n  raise_user_name: ""\n  # 提出人所在中心(会被上面的覆盖掉)\n  raise_user_centre: ""\n  # 1:中心 2:自己 3:对领导 4:对下属 5:对内部(会被上面的覆盖掉)\n  type: "0"\n  # 提出人区域(会被上面的覆盖掉)\n  area: "FY"\n  crmArea: ""\n  # 紧急程度 A:重要且紧急 B:重要不紧急 C:不重要紧急(会被上面的覆盖掉)\n  level: "C"\n  # 使用上面的submitBody\n  body: ""\n  attach_url: []\n  owner_user_id: ""\n  owner_user_name: ""\n  owner_user_centre: ""\n  execute_user_id: []\n  execute_user_name: ""\n  # 完成时间(毫秒时间戳13位，https://www.jyshare.com/front-end/852/?utm_source=heifan)\n  # 如果时间戳为0则自动获取当前月份的最后一天时间23:00:00.000的时间戳\n  finish_time: 0\n  beforeJudge: 2\n  create_time: ""\n  meeting_resolution_time: null\n  status: 3\n  jnpf_meeting_task_jnpf_is_satisfaction: "-1"\n',ue=n(_.load(ie));ue.aiKey=G.value,ue.aiModel=X.value,ue.apiUrl=ee.value,ue.mobile=te.value,ue.password=ae.value;const ce=a(Z.refTime||1),de=a(Z.area||"FY"),me=a(Z.level||"C"),pe=a(Z.executeMode||"");ue.refTime=ce.value,ue.area=de.value,ue.level=me.value,ue.executeMode=pe.value,ie=(ie=(ie=(ie=ie.replace("refTime: ",`refTime: ${ue.refTime}`)).replace('area: ""',`area: "${ue.area}"`)).replace('level: ""',`level: "${ue.level}"`)).replace('executeMode: ""',`level: "${ue.executeMode}"`);const fe=a(ie),ye=async()=>{try{const e=fe.value;if(ne.value="",re.value="",le.value=!0,!e)return console.error("YAML text is empty."),ge("YAML text is empty.","error"),void(le.value=!1);const t=_.load(e);if((ue={...ue,...t}).toUser=ue.submitBodyInfo.map((e=>Object.keys(e)[0])),ue.submitBody=ue.submitBodyInfo.map((e=>Object.values(e)[0])),!ve(ue))return void(le.value=!1);localStorage.setItem("allResult",JSON.stringify(ue)),ge("开始登录");const a=await T({mobile:ue.mobile,password:ue.password});if(localStorage.setItem("usertoken",a),a){ge("登录成功","success"),ge("开始获取登录信息"),Ce();await B()?(ge("获取登录信息成功","success"),he(ue)):(ge("获取登录信息失败","error"),le.value=!1)}else ge("登录失败","error"),le.value=!1}catch(Te){console.error(Te),ge("报错了：\n"+Te.message,"error"),le.value=!1}},ve=e=>!e.mobile||e.mobile.length<1?(ge("没有手机号","error"),!1):!e.password||e.password.length<1?(ge("没有密码","error"),!1):["userSequence","itemCross"].includes(e.executeMode)?e.toUser.length<1||e.toUser[0].length<1?(ge("没有接收人","error"),!1):e.area.length<1?(ge("没有提出人区域","error"),!1):e.submitBody.length<1||e.submitBody[0].length<1?(ge("没有提交内容","error"),!1):!(e.toUser.length!==e.submitBody.length||!e.submitBody.every((e=>e.length>0)))||(ge("接收人和提交内容维度不匹配","error"),!1):(ge("无效的执行模式","error"),!1),he=async(e,t=!1)=>{try{if(t)throw ge("已请求停止执行","warning"),new Error("用户主动中止循环");{const t=6e4*e.refTime;ge(`定时器间隔：${e.refTime}分钟`);const a=async(t,a)=>{const n=e.submitBody[t][a],r=e.toUser[t];ge(`提交给【${r}】的第 ${a+1} 项任务`);var l=n;if(e.aiKey.length){ge("使用AI进行处理");var o=await U(n,e);o&&o.choices&&o.choices.length>0?(l=o.choices[0].message.content,ge("AI返回信息："+l)):ge("AI返回数据异常，使用默认值")}var s=await I(r,l,e);if(-1!=s.indexOf("没有找到touser用户信息"))throw ge(s,"error"),new Error("找不到接收人");if(-1!=s.indexOf("没有找到用户信息"))throw ge(s,"error"),new Error("没有找到用户信息");if(-1!=s.indexOf("提交失败"))throw ge(s,"error"),new Error("提交失败了，稍后尝试");ge(s,"success")},n={userSequence:async()=>{for(let n=0;n<e.toUser.length;n++){const r=e.submitBody[n];for(let e=0;e<r.length;e++){if(!le.value)return;await a(n,e),await new Promise((e=>setTimeout(e,t)))}}},itemCross:async()=>{const n=Math.max(...e.submitBody.map((e=>e.length)));for(let r=0;r<n;r++)for(let n=0;n<e.toUser.length;n++)if(r<e.submitBody[n].length){if(!le.value)return;await a(n,r),await new Promise((e=>setTimeout(e,t)))}}};"userSequence"===e.executeMode?await n.userSequence():await n.itemCross(),ge("所有提交已结束，请重新配置")}}catch(Te){if(!Te.message.includes("中止循环"))throw ge(""+Te.message,"error"),Te;ge(Te.message,"error")}finally{le.value=!1,R.value=!1,ke()}},ge=(e,t="info")=>{const a=`<span style="color: ${{error:"red",success:"green",warning:"orange",info:"#333"}[t]}">${e} ${xe()}</span>`;re.value=re.value?`${re.value}<br>${a}`:a},xe=()=>(new Date).toLocaleString(),we=()=>{W.push({name:`模版${W.length+1}`,content:fe.value}),be()},be=()=>{const e=JSON.stringify(W);localStorage.setItem("allTempleStr",e)},_e=()=>{const{ipcRenderer:e}=require("electron");e.send("app-quit")};var Se=n({t1:0,t2:0,t3:0,t4:0,t5:0,t6:0,t7:0});const ke=async()=>{try{const e=localStorage.getItem("usertoken")||"";if(!e)return void Object.assign(Se,{t2:"未登录",t4:"未登录"});const t=await k(e);Object.assign(Se,t)}catch(Te){console.error("获取数量信息失败:",Te)}};ke();const Ce=async()=>{try{se=await C(),oe=se.some((e=>e.mobile===ue.mobile))}catch(Te){console.error("获取用户列表失败:",Te)}};return Ce(),(e,t)=>(y(),r("div",M,[l("div",$,[l("div",j,[l("div",null,"总提报："+s(i(Se).t2),1),l("div",null,"未处理："+s(i(Se).t4),1)]),(y(!0),r(u,null,c(W,((e,t)=>(y(),r("div",{key:e,style:{display:"flex","flex-direction":"column","margin-left":"8px"}},[m(l("input",{type:"text","onUpdate:modelValue":t=>e.name=t,style:{width:"80px","margin-right":"5px"},onBlur:be},null,40,A),[[p,e.name]]),l("div",O,[l("button",{onClick:e=>(e=>{fe.value=W[e].content})(t)},"使用",8,q),l("button",{onClick:e=>(e=>{W.splice(e,1),be()})(t)},"删除",8,V)])])))),128)),l("button",{style:{"margin-left":"18px","max-height":"50px"},onClick:we},"保存当前配置为模版"),l("button",{style:{"margin-left":"8px","max-height":"50px"},onClick:_e},"退出"),i(oe)?(y(),r("div",{key:0,style:{"margin-left":"8px","max-height":"50px"},onClick:D},"跳转回复")):o("v-if",!0)]),l("div",E,[o(' <textarea name="yaml" id="" v-model="yamlContent" style="height: 100%;width: 30%;resize: none;"\n                spellcheck="false"></textarea> '),d(i(S),{ref:"mycodemirror",modelValue:fe.value,"onUpdate:modelValue":t[0]||(t[0]=e=>fe.value=e),disabled:!1,indentWithTab:!0,extensions:z,placeholder:"请输入yaml配置",tabSize:2,style:{height:"100%",width:"50%",resize:"none","text-align":"left"}},null,8,["modelValue"]),l("div",N,[l("div",F,[l("div",H,[m(l("input",{type:"text",placeholder:"请输入手机号","onUpdate:modelValue":t[1]||(t[1]=e=>i(ue).mobile=e)},null,512),[[p,i(ue).mobile]]),m(l("input",{type:"password",placeholder:"请输入密码","onUpdate:modelValue":t[2]||(t[2]=e=>i(ue).password=e)},null,512),[[p,i(ue).password]])]),o(' <div>\n                        <input type="password" placeholder="ai的key，为空不使用AI" v-model="result.aiKey" />\n                        <input type="text" placeholder="ai的模型" v-model="result.aiModel" />\n                        <input type="text" placeholder="为空则使用https://api.openai.com" v-model="result.apiUrl" />\n                    </div> ')]),t[4]||(t[4]=l("div",{class:"text-info",style:{"text-align":"left"}},"清单打印信息",-1)),l("div",{class:"log-area",innerHTML:re.value,disabled:"true"},null,8,J),l("button",{onClick:ye,disabled:le.value},"开始执行",8,L),m(l("button",{onClick:t[3]||(t[3]=e=>he(i(ue),!0))},"停止执行",512),[[f,le.value]])])])]))}},[["__scopeId","data-v-edfe046f"],["__file","/Users/UED/Desktop/test/electron-egg/frontend/src/views/home/home.vue"]]);export{Y as default};
